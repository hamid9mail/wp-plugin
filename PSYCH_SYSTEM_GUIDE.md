# راهنمای کامل سیستم جامع روان گستر (Psych Complete System)

## مقدمه
این راهنما به شما کمک می‌کند تا از تمام قابلیت‌ها و شورت‌کدهای موجود در سیستم جامع روان گستر، به خصوص ماژول قدرتمند مسیر رشد (Path Engine)، به بهترین شکل استفاده کنید. این سیستم برای ایجاد تجربه‌های یادگیری پویا، تعاملی و شخصی‌سازی شده طراحی شده است.

---

## بخش ۱: ماژول مسیر رشد (Path Engine)

### ۱.۱ - مفهوم کلیدی: سیستم چند بازیگری (Multi-Actor System)
یکی از قدرتمندترین ویژگی‌های سیستم مسیر رشد، توانایی آن در مدیریت "بازیگران" (Actors) مختلف است. این یعنی سیستم به خوبی درک می‌کند که **چه کسی** در حال انجام یک عمل است و آن عمل **برای چه کسی** ثبت می‌شود.

**این قابلیت چه کاربردی دارد؟**
سناریوی رایج، تعامل **مربی** و **دانشجو** است. یک مربی ممکن است وارد پروفایل دانشجو شود و یک فرم ارزیابی را برای او پر کند. در این حالت:
*   **بازیگر (Actor):** مربی است.
*   **هدف (Target):** دانشجو است.

سیستم به صورت هوشمند و خودکار این تفکیک را انجام می‌دهد. زمانی که یک فرم گرویتی (Gravity Form) در یک ایستگاه قرار می‌گیرد، سیستم فیلدهای مخفی لازم را به آن اضافه می‌کند تا همیشه مشخص باشد که فرم برای کدام دانشجو در حال پر شدن است، حتی اگر مربی آن را ارسال کند.

**نتیجه:** تمام امتیازات، پاداش‌ها و تکمیل ماموریت‌ها به درستی به حساب **دانشجو** واریز می‌شود، نه مربی. این ویژگی زیربنای اصلی تعاملات مربی-محور در سیستم است و به شما اجازه می‌دهد سناریوهای ارزیابی، تایید و بازخورد بسیار پیشرفته‌ای را پیاده‌سازی کنید.

---
این ماژول به شما اجازه می‌دهد تا مسیرهای یادگیری پیچیده، شرطی و تعاملی برای کاربران خود بسازید.

### ۱.۲ - شورت‌کد اصلی مسیر: `[psychocourse_path]`
این شورت‌کد به عنوان کانتینر اصلی برای یک مسیر عمل می‌کند. تمام ایستگاه‌ها باید درون آن قرار گیرند.

**ویژگی‌ها:**
*   `display_mode` (نوع: `string`, پیش‌فرض: `timeline`): نحوه نمایش مسیر را تعیین می‌کند. مقادیر مجاز:
    *   `timeline`: نمایش کلاسیک به صورت خط زمانی.
    *   `accordion`: نمایش به صورت پنل‌های آکاردئونی.
    *   `cards`: نمایش هر ایستگاه به صورت یک کارت مجزا.
    *   `treasure_map`: نمایش فانتزی به صورت نقشه گنج.
    *   `simple_list`: یک لیست ساده و تمیز.
*   `theme` (نوع: `string`, پیش‌فرض: `default`): تم رنگی مسیر را مشخص می‌کند. مقادیر مجاز: `default`, `dark`, `minimal`, `colorful`.
*   `show_progress` (نوع: `boolean`, پیش‌فرض: `true`): نوار پیشرفت کلی مسیر را نمایش می‌دهد یا پنهان می‌کند.
*   `path_title` (نوع: `string`, پیش‌فرض: `''`): یک عنوان برای کل مسیر نمایش می‌دهد.

**مثال:**
```html
[psychocourse_path display_mode="cards" theme="dark" path_title="مسیر تسلط بر مفاهیم پایه"]
  ... ایستگاه‌ها در اینجا قرار می‌گیرند ...
[/psychocourse_path]
```
*توضیح:* این مثال یک مسیر با عنوان "مسیر تسلط بر مفاهیم پایه" ایجاد می‌کند که ایستگاه‌های آن به صورت کارتی و با تم تیره نمایش داده می‌شوند.

---

### ۱.۳ - شورت‌کد ایستگاه: `[station]`
قلب تپنده مسیر شما. هر `[station]` یک مرحله یا ماموریت در مسیر است.

**ویژگی‌های کلیدی:**
*   `title` (نوع: `string`, **الزامی**): عنوان ایستگاه که به کاربر نمایش داده می‌شود.
*   `mission_type` (نوع: `string`, پیش‌فرض: `button_click`): نوع ماموریتی که کاربر باید برای تکمیل ایستگاه انجام دهد.
*   `mission_target` (نوع: `string`): هدف ماموریت. مقدار این ویژگی به `mission_type` بستگی دارد.
*   `rewards` (نوع: `string`): پاداش‌هایی که کاربر پس از تکمیل ایستگاه دریافت می‌کند. پاداش‌ها با `|` از هم جدا می‌شوند.
*   `unlock_trigger` (نوع: `string`, پیش‌فرض: `sequential`): شرط باز شدن ایستگاه. `sequential` یعنی ایستگاه قبلی باید تکمیل شده باشد. `independent` یعنی ایستگاه به مراحل قبلی وابسته نیست.
*   `visibility_flag` (نوع: `string`): ایستگاه را تا زمانی که فلگ مشخص شده برای کاربر ست نشده باشد، پنهان نگه می‌دارد.
*   `unlock_condition` (نوع: `string`): شروط پیشرفته برای باز شدن ایستگاه (جایگزین `unlock_trigger`).
*   `icon` (نوع: `string`, پیش‌فرض: `fas fa-flag`): آیکون ایستگاه از کتابخانه Font Awesome.
*   `mission_required_submissions` (نوع: `integer`, پیش‌فرض: `1`): برای ماموریت‌های `gform`، تعداد فرم‌هایی که باید ارسال شود.

**مثال‌ها:**

**مثال ۱: ایستگاه ساده با کلیک**
```html
[station title="قدم اول: اعلام آمادگی" rewards="add_points:10"]
  [mission_content]
    <p>برای شروع مسیر، روی دکمه تکمیل کلیک کنید.</p>
  [/mission_content]
  [result_content]
    <p>عالی! ۱۰ امتیاز کسب کردید. به مرحله بعد بروید.</p>
  [/result_content]
[/station]
```
*توضیح:* یک ایستگاه ساده که کاربر با کلیک روی دکمه آن را تکمیل کرده و ۱۰ امتیاز پاداش می‌گیرد.

**مثال ۲: ماموریت با گرویتی فرم و شمارشگر**
```html
[station title="ثبت بازخورد هفتگی (۳ بار)" mission_type="gform" mission_target="form_id:7" mission_required_submissions="3" rewards="add_points:50|award_badge:12"]
  [mission_content]
    <p>برای تکمیل این مرحله، باید ۳ بار فرم بازخورد هفتگی را پر کنید.</p>
    <p>وضعیت شما: [mission_submission_count]</p>
    [gravityform id="7" ajax="true"]
  [/mission_content]
  [result_content]
    <p>از بازخوردهای شما متشکریم! ۵۰ امتیاز و نشان "مشارکت فعال" به شما تعلق گرفت.</p>
  [/result_content]
[/station]
```
*توضیح:* کاربر باید فرم شماره ۷ را ۳ بار ارسال کند. شورت‌کد `[mission_submission_count]` پیشرفت او را نشان می‌دهد. پس از ارسال سوم، ۵۰ امتیاز و نشان شماره ۱۲ را دریافت می‌کند.

**مثال ۳: ایستگاه خرید محصول**
```html
[station title="خرید کتاب الکترونیکی" mission_type="purchase" mission_target="product_id:250" rewards="add_points:100"]
  [mission_content]
    <p>برای ادامه، باید کتاب "مقدمات روانشناسی رشد" را از فروشگاه تهیه کنید.</p>
  [/mission_content]
  [result_content]
    <p>خرید شما با موفقیت ثبت شد و ۱۰۰ امتیاز دریافت کردید.</p>
  [/result_content]
[/station]
```
*توضیح:* این ایستگاه تنها زمانی تکمیل می‌شود که کاربر محصول با شناسه ۲۵۰ را خریداری کرده باشد.

**مثال ۴: ایستگاه شرطی و پنهان**
```html
[station title="ماموریت ویژه اعضای طلایی" unlock_condition="has_badge:gold_member" rewards="reveal_station:secret_path"]
  [mission_content]
     <p>با تکمیل این ماموریت، یک مسیر مخفی برای شما نمایان خواهد شد.</p>
  [/mission_content]
[/station]

[station title="مسیر مخفی" visibility_flag="secret_path"]
  [mission_content]
    <p>تبریک! شما مسیر مخفی را پیدا کردید!</p>
  [/mission_content]
[/station]
```
*توضیح:* ایستگاه اول فقط برای کاربرانی که نشان `gold_member` را دارند باز می‌شود. پس از تکمیل آن، پاداش `reveal_station` باعث می‌شود ایستگاه دوم که با `visibility_flag="secret_path"` پنهان شده بود، برای کاربر نمایان شود.

**مثال ۵: ایستگاه قابل تکمیل با کد خارجی (Flag)**
```html
[station title="تکمیل پروفایل کاربری" mission_type="flag" mission_target="profile_completed_successfully"]
  [mission_content]
    <p>برای تکمیل این مرحله، به صفحه پروفایل خود رفته و تمام اطلاعات را کامل کنید.</p>
  [/mission_content]
  [result_content]
    <p>پروفایل شما با موفقیت تکمیل شد.</p>
  [/result_content]
[/station]
```
*توضیح:* این ایستگاه منتظر یک "فلگ" به نام `profile_completed_successfully` است. توسعه‌دهنده می‌تواند پس از اینکه کاربر پروفایلش را با موفقیت ذخیره کرد، تابع `psych_complete_mission_by_flag('profile_completed_successfully', $user_id);` را در کد PHP فراخوانی کند تا این ایستگاه به صورت خودکار تکمیل شود.

---

### ۱.۴ - شورت‌کدهای محتوای ایستگاه
این شورت‌کدها برای سازماندهی محتوا درون یک `[station]` استفاده می‌شوند.

*   `[static_content]...[/static_content]`: محتوای ثابت که همیشه (قبل و بعد از تکمیل) نمایش داده می‌شود.
*   `[mission_content]...[/mission_content]`: محتوای ماموریت که قبل از تکمیل نمایش داده می‌شود.
*   `[result_content]...[/result_content]`: محتوای نتیجه که بعد از تکمیل نمایش داده می‌شود.

---

### ۱.۵ - شورت‌کدهای شرطی و دینامیک
این شورت‌کدها به شما اجازه می‌دهند محتوای یکسانی را به افراد مختلف، به شیوه‌های متفاوتی نمایش دهید.

*   `[student_only]...[/student_only]`: محتوای داخل آن فقط برای دانشجو قابل مشاهده است.
*   `[coach_only]...[/coach_only]`: محتوای داخل آن فقط برای مربی (که در حال مشاهده صفحه دانشجو است) قابل مشاهده است.
*   `[mission_submission_count]`: شمارنده پاسخ‌های فرم را نمایش می‌دهد (فقط در ایستگاه‌های `gform`).

**مثال ترکیبی:**
```html
[station title="ارزیابی توسط مربی"]
  [mission_content]
    [student_only]
      <p>پاسخ‌های شما برای مربی ارسال شد. لطفاً منتظر ارزیابی ایشان بمانید.</p>
    [/student_only]
    [coach_only]
      <p>لطفاً پاسخ‌های دانشجو را بررسی کرده و پس از تایید، ماموریت را به صورت دستی برای او تکمیل کنید.</p>
      <button>تکمیل برای دانشجو</button>
    [/coach_only]
  [/mission_content]
</station>
```
---

## بخش ۲: شورت‌کدهای عمومی و گیمیفیکیشن
این شورت‌کدها می‌توانند در هر جای سایت (برگه‌ها، نوشته‌ها، سایدبار و ...) برای نمایش اطلاعات مربوط به کاربر و سیستم گیمیفیکیشن استفاده شوند.

| شورت‌کد | هدف | مثال استفاده |
| :--- | :--- | :--- |
| `[psych_dashboard]` | نمایش داشبورد کامل کاربر. | `[psych_dashboard show_sections="progress,gamification"]` |
| `[psych_report_card]` | نمایش کارنامه عملکردی کاربر. | `[psych_report_card user_id="15"]` (نمایش برای کاربر با شناسه ۱۵) |
| `[psych_leaderboard]` | نمایش جدول رده‌بندی کاربران. | `[psych_leaderboard count="10" time_frame="monthly"]` |
| `[psych_user_points]` | نمایش امتیازات کاربر فعلی. | `شما [psych_user_points] امتیاز دارید.` |
| `[psych_user_level]` | نمایش سطح کاربری فعلی. | `سطح شما: [psych_user_level show_icon="true"]` |
| `[psych_user_badges]` | نمایش نشان‌های کاربر فعلی. | `[psych_user_badges limit="5"]` (نمایش ۵ نشان آخر) |

---
## بخش ۳: مثال جامع و کامل (Full Structure Example)
در زیر یک مثال کامل و پیچیده از یک مسیر یادگیری آورده شده است که بسیاری از شورت‌کدها و ویژگی‌های پیشرفته را در عمل نشان می‌دهد. شما می‌توانید این ساختار را کپی کرده و بر اساس نیاز خود تغییر دهید.

```html
[psychocourse_path display_mode="timeline" path_title="سفر قهرمانی شما"]

  <!-- ایستگاه اول: شروع ماجرا -->
  [station title="فصل اول: پذیرش دعوت" icon="fas fa-dungeon" rewards="add_points:10"]
    [static_content]
      <h4>به سفر قهرمانی خوش آمدید!</h4>
    [/static_content]
    [mission_content]
      <p>هر سفری با قدم اول آغاز می‌شود. برای شروع ماجراجویی و کسب اولین امتیاز، روی دکمه زیر کلیک کنید.</p>
    [/mission_content]
    [result_content]
      <p>تبریک! شما دعوت را پذیرفتید. ۱۰ امتیاز به حساب شما واریز شد. حال به سراغ چالش بعدی بروید.</p>
    [/result_content]
  [/station]

  <!-- ایستگاه دوم: آزمون ورودی (گرویتی فرم) -->
  [station title="فصل دوم: آزمون شناخت" mission_type="gform" mission_target="form_id:4" rewards="add_points:50|reveal_station:path_of_wisdom"]
    [mission_content]
      <p>برای ادامه، باید آزمون شناخت اولیه را تکمیل کنید تا مسیر شما شخصی‌سازی شود.</p>
      [student_only]
        <p>لطفاً به سوالات زیر با دقت پاسخ دهید.</p>
      [/student_only]
      [coach_only]
        <p><strong>نکته برای مربی:</strong> این آزمون به شما درک بهتری از وضعیت اولیه دانشجو می‌دهد.</p>
      [/coach_only]
      [gravityform id="4" ajax="true"]
    [/content]
    [result_content]
      <p>آزمون شما با موفقیت ثبت شد. ۵۰ امتیاز دریافت کردید و یک مسیر فرعی برایتان باز شد!</p>
    [/result_content]
  [/station]

  <!-- ایستگاه سوم: تهیه تجهیزات (خرید محصول) -->
  [station title="فصل سوم: تجهیزات سفر" mission_type="purchase" mission_target="product_id:101" rewards="add_points:100|award_badge:5"]
    [mission_content]
      <p>هر قهرمانی به ابزار نیاز دارد. برای عبور از این مرحله، "پکیج کامل ابزارهای رشد فردی" را از فروشگاه تهیه کنید.</p>
    [/mission_content]
    [result_content]
      <p>عالی! تجهیزات شما کامل شد. ۱۰۰ امتیاز و نشان "مجهز" را دریافت کردید.</p>
    [/result_content]
  [/station]

  <!-- ایستگاه چهارم: مسیر فرعی و پنهان (فقط پس از آزمون باز می‌شود) -->
  [station title="مسیر فرعی: طریق خرد" icon="fas fa-scroll" visibility_flag="path_of_wisdom" unlock_trigger="independent"]
    [mission_content]
      <p>شما با موفقیت در آزمون، این مسیر مخفی را برای خود گشودید. این مرحله به دانش شما عمق بیشتری می‌بخشد.</p>
    [/mission_content]
    [result_content]
      <p>خرد شما افزایش یافت.</p>
    [/result_content]
  [/station]

  <!-- ایستگاه پنجم: چالش نهایی (فقط برای کاربران سطح بالا) -->
  [station title="فصل چهارم: غار اژدها" icon="fas fa-dragon" unlock_condition="min_points:500|has_badge:5"]
    [mission_content]
      <p>شما به چالش نهایی رسیده‌اید. این مرحله تنها برای قهرمانانی باز است که حداقل ۵۰۰ امتیاز و نشان "مجهز" را داشته باشند.</p>
    [/mission_content]
    [result_content]
      <h4>شما اژدها را شکست دادید!</h4>
      <p>تمام نشان‌های شما:</p>
      [psych_user_badges]
    [/result_content]
  [/station]

[/psychocourse_path]
```
---
## بخش ۴: ماژول شخصی‌سازی (Personalization Module)
این ماژول یک شورت‌کد بسیار قدرتمند به نام `[psych_personalize]` اضافه می‌کند که به شما اجازه می‌دهد محتوای خاصی را بر اساس شرایط مختلف مربوط به کاربر (مانند اطلاعات پروفایل، امتیاز، نقش کاربری، نتایج آزمون و ...) نمایش دهید یا پنهان کنید. این شورت‌کد می‌تواند در هر کجای سایت استفاده شود.

### `[psych_personalize]`

**هدف:** نمایش شرطی محتوا.

**ویژگی‌ها:**
*   `condition` (نوع: `string`, **الزامی**): شرطی که باید برای نمایش محتوا برقرار باشد.

**ساختار شرط (Condition Syntax):**
شرط‌ها از سه بخش اصلی تشکیل شده‌اند: `منبع:شناسه عملگر مقدار`
*   **منبع (Source):** داده از کجا خوانده شود (`profile`, `quiz`, `role`, `points`, `badge`).
*   **شناسه (ID):** شناسه داده مورد نظر (نام فیلد پروفایل، نام آزمون، نام نقش و ...).
*   **عملگر (Operator):** عملگر مقایسه (`=`, `!=`, `>`, `<`, `>=`, `<=`).
*   **مقدار (Value):** مقداری که باید با آن مقایسه شود.

**منابع معتبر برای شرط:**

| منبع (Source) | شناسه (ID) | توضیح | مثال شرط |
| :--- | :--- | :--- | :--- |
| `profile` | نام متا فیلد کاربر | مقدار یک فیلد از پروفایل کاربر را چک می‌کند. | `profile:gender=male` |
| `quiz` | نام یا شناسه آزمون | نمره آخرین آزمون کاربر را چک می‌کند. | `quiz:stress_test>=75` |
| `role`| نام نقش کاربری | نقش کاربر را چک می‌کند. | `role=subscriber` |
| `points` | ندارد | کل امتیازات کاربر را چک می‌کند. | `points>1000` |
| `badge` | نام یا شناسه نشان | وجود یک نشان خاص را برای کاربر چک می‌کند. | `badge:pro_member=true` |

**مثال‌ها:**

**مثال ۱: نمایش محتوا به کاربران با امتیاز بالا**
```html
[psych_personalize condition="points>=1000"]
  <div class="vip-offer">
    <h4>پیشنهاد ویژه برای اعضای VIP!</h4>
    <p>شما به دلیل فعالیت و امتیاز بالای خود، یک جلسه مشاوره رایگان دریافت کرده‌اید.</p>
  </div>
[/psych_personalize]
```
*توضیح:* این بلوک HTML فقط به کاربرانی نمایش داده می‌شود که ۱۰۰۰ امتیاز یا بیشتر داشته باشند.

**مثال ۲: نمایش پیام‌های مختلف بر اساس نتیجه آزمون**
```html
[psych_personalize condition="quiz:stress_test>70"]
  <p>نتیجه آزمون استرس شما نشان‌دهنده سطح استرس بالایی است. توصیه می‌کنیم در دوره مدیریت استرس ما شرکت کنید.</p>
[/psych_personalize]

[psych_personalize condition="quiz:stress_test<=70"]
  <p>نتیجه آزمون استرس شما در محدوده نرمال قرار دارد. برای حفظ این وضعیت، تمرینات ذهن‌آگاهی را ادامه دهید.</p>
[/psych_personalize]
```
*توضیح:* بسته به نمره کاربر در "آزمون استرس"، یکی از دو پیام متفاوت به او نمایش داده می‌شود.

**مثال ۳: نمایش محتوا فقط به کاربرانی با یک نشان خاص**
```html
[psych_personalize condition="badge:alpha_tester=true"]
  <p>از اینکه به عنوان تست‌کننده آلفا به ما کمک می‌کنید متشکریم! لطفاً بازخورد خود را از طریق این فرم برای ما ارسال کنید.</p>
[/psych_personalize]
```
*توضیح:* این پیام فقط برای کاربرانی که نشان `alpha_tester` را دارند قابل مشاهده است.
